!function(){var a={version:"0.0.1-dev"};"object"==typeof module&&"object"==typeof module.exports&&(module.exports=a),"undefined"!=typeof window&&window.L&&(window.L.DNC=a)}(),L.DNC=L.DNC||{},L.DNC.AppController=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.mapView=new L.DNC.MapView,this.dropzone=new L.DNC.DropZone(this.mapView._map,{}),this.layerlist=new L.DNC.LayerList(this.mapView._map,{layerContainerId:"sidebar"}),this.menubar=new L.DNC.MenuBar({id:"menu-bar"}).addTo(document.body),this.bottom_menu=new L.DNC.MenuBar({id:"add-remove",classList:["bottom","menu"]}).addTo(document.getElementById("sidebar")),this.menus={geo:new L.DNC.Menu("Geoprocessing",{items:["bezier","buffer","center","centroid","envelope","union","tin"]}).addTo(this.menubar),addLayer:new L.DNC.Menu("Add",{items:["upload","load from url"],menuDirection:"above",iconClassName:"fa fa-plus"}).addTo(this.bottom_menu),removeLayer:new L.DNC.Menu("Remove",{iconClassName:"fa fa-minus"}).addTo(this.bottom_menu)},this.geoOpsConfig={operations:new L.DNC.Geo,executor:new L.DNC.GeoExecute},this.fileOpsConfig={operations:new L.DNC.File,executor:new L.DNC.FileExecute},this.forms=new L.DNC.Forms,this.notification=new L.DNC.Notifications,this._addEventHandlers()},_addEventHandlers:function(){this.dropzone.fileReader.on("fileparsed",this._handleParsedFile.bind(this)),this.fileOpsConfig.executor.on("uploadedfiles",this.dropzone.fileReader._handleFiles.bind(this.dropzone.fileReader)),this.menus.geo.on("clickedOperation",this._handleOperationClick.bind(this,this.geoOpsConfig)),this.menus.addLayer.on("clickedOperation",this._handleOperationClick.bind(this,this.fileOpsConfig)),this.menus.removeLayer.on("clickedOperation",this._handleOperationClick.bind(this,this.fileOpsConfig))},_handleOperationClick:function(a,b){var c=a.operations[b.action];try{a.executor.validate(b.action,this.getLayerSelection(),c)}catch(d){return this.notification.add({text:d.message,type:"alert",time:2500}),void console.error(d)}if(c.disableForm)return this._handleFormSubmit(a,b);var e=this.forms.render(b.action,c);e.on("submit",this._handleFormSubmit.bind(this,a))},_handleFormSubmit:function(a,b){var c=a.operations[b.action];a.executor.execute(b.action,b.parameters,c,this.getLayerSelection(),function(a){return this._handleResults(a)}.bind(this))},_handleParsedFile:function(a){var b=L.mapbox.featureLayer(a.file);this.layerlist.addLayer(b,a.fileInfo.name),this.mapView.numLayers++,this.notification.add({text:"<strong>"+a.fileInfo.name+"</strong> added successfully.",type:"success",time:2500})},_handleResults:function(a){if(!a)return console.warn("No results returned from operation.");var b,c;if(a.add&&a.add.length)for(b=0;b<a.add.length;b++){c=a.add[b];var d=L.mapbox.featureLayer(c.geometry);this.layerlist.addLayer(d,c.name),this.notification.add({text:"<strong>"+c.name+"</strong> created successfully.",type:"success",time:2500})}if(a.remove&&a.remove.length)for(b=0;b<a.remove.length;b++)c=a.remove[b],this.layerlist.removeLayer(c.layer),this.notification.add({text:"<strong>"+c.name+"</strong> removed successfully.",type:"success",time:2500})},getLayerSelection:function(){return this.layerlist.selection.list||[]}}),L.DNC=L.DNC||{},L.DNC.DropZone=L.Class.extend({statics:{TYPE:"dropzone"},options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this.type=L.DNC.DropZone.TYPE,this.fileReader=new L.DNC.DropZone.FileReader(this._map,b),this.fileReader.enable()}}),L.DNC.DropZone=L.DNC.DropZone||{},L.DNC.DropZone.FileReader=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this._container=document.body},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{options:this.options}),this._map.fire("dropzone:enabled",{options:this.options}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("dropzone:disabled",{options:this.options}),this.fire("disabled",{options:this.options}))},addHooks:function(){this._map&&(L.DomEvent.on(this._container,"dragover",this._handleDragOver,this),L.DomEvent.on(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.on(this._container,"drop",this._handleDrop,this))},removeHooks:function(){this._map&&(L.DomEvent.off(this._container,"dragover",this._handleDragOver,this),L.DomEvent.off(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.off(this._container,"drop",this._handleDrop,this))},_handleDragOver:function(a){a=a||event,a.preventDefault(),document.body.className="dragging"},_handleDragLeave:function(a){a=a||event,a.preventDefault(),document.body.className=""},_handleDrop:function(a){a=a||event,a.preventDefault(),document.body.className="";var b=a.dataTransfer.files;this._handleFiles(b)},_handleFiles:function(a){for(var b=0;b<a.length;b++)this._readFile(a[b])},_readFile:function(a){var b=new FileReader;b.readAsText(a,"UTF-8"),b.onload=function(){var c=JSON.parse(b.result);this._map.fire("dropzone:fileparsed",{file:c}),this.fire("fileparsed",{fileInfo:a,file:c})}.bind(this)}}),L.DNC=L.DNC||{},L.DNC.Forms=L.Class.extend({includes:L.Mixin.Events,options:{},render:function(a,b){this.title=a,this.paramArray=[],this.options={},L.setOptions(this,b);var c='<div class="form-inner"><div class="form"><button type="button" class="btn close form-close"><i class="fa fa-times"></i></button><div class="form-information"><h3 class="form-title">'+this.title+"</h3>";if(this.options.description&&(c+='<p class="form-description">'+this.options.description+"</p>"),c+='</div><form id="operation-form" class="form-inputs">',this.options.parameters)for(var d=0;d<this.options.parameters.length;d++){var e=this.options.parameters[d],f='<div class="parameter">';e.name&&(f+='<label class="parameter-name">'+e.name+"</label>"),f+="select"==e.type?this._inputTypeSelect(e):this._inputTypeDefault(e),e.description&&(f+='<p class="parameter-description">'+e.description+"</p>"),c+=f+"</div>"}c+='<button type="button" class="btn form-submit" id="operation-submit">Execute<i class="fa fa-thumbs-o-up push-left"></i></button>',c+="</div></div>";var g=document.createElement("div");return g.className="form-outer",g.id="DNC-FORM",g.innerHTML=c,document.body.appendChild(g),this.domElement=g,this._formHandlers(g),this},closeForm:function(){var a=document.getElementById("DNC-FORM");a.parentElement.removeChild(a)},submitForm:function(){this.paramArray=[];for(var a=document.getElementsByClassName("param"),b=0;b<a.length;b++){var c=null;"SELECT"==a[b].nodeName?c=a[b].options[a[b].selectedIndex].value:(c=a[b].value,"number"==a[b].type&&(c=parseInt(c))),this.paramArray.push(c)}this.validateForm()&&(this.fire("submit",{action:this.title,parameters:this.paramArray}),this.closeForm(),this._leaflet_events.submit=[])},validateForm:function(){return!0},_formHandlers:function(){for(var a=this,b=document.getElementsByClassName("form-close"),c=0;c<b.length;c++)b[c].addEventListener("click",this.closeForm.bind(this));var d=document.getElementById("operation-form");d.addEventListener("keypress",function(b){13==b.keyCode&&(b.preventDefault(),a.submitForm())});var e=document.getElementById("operation-submit");e.addEventListener("click",this.submitForm.bind(this))},_inputTypeDefault:function(a){var b='<input class="param" name="'+a.name+'" type="'+a.type+'" value="'+(a["default"]||"")+'"'+(a.extra||"")+">";return b},_inputTypeSelect:function(a){for(var b='<select class="param" type="select" name="'+a.name+'">',c=0;c<a.options.length;c++)b+='<option value="'+a.options[c]+'"',a.options[c]==a["default"]&&(b+=" selected"),b+=">"+a.options[c]+"</option>";return b+"</select>"}}),L.DNC=L.DNC||{},L.DNC.LayerList=L.Control.extend({options:{autoZIndex:!0,zoomToExtentOnAdd:!0,layerContainerId:"dropzone"},initialize:function(a,b){L.setOptions(this,b),this._map=a,this._layers={},this._lastZIndex=0,this._handlingClick=!1,this.domElement=this._buildDomElement(),this.layerContainer=L.DomUtil.get(this.options.layerContainerId),this.layerContainer.appendChild(this.domElement),this.selection={add:function(a){this.list.push(a)},remove:function(a){for(var b=0;b<this.list.length;b++)a._leaflet_id==this.list[b].layer._leaflet_id&&this.list.splice(b,1)},clear:function(){for(var a=document.getElementsByClassName("layer-name"),b=0;b<a.length;b++)a[b].className=a[b].className.replace(/\b selected\b/,"");this.list=[]},list:[]}},_buildDomElement:function(){var a=L.DomUtil.create("ul","json-layer-list");return a.setAttribute("id","layer-list"),a},addLayer:function(a,b){var c={layer:a,name:b};c.domElement=this._buildListItemDomElement(c);var d=L.stamp(a);if(this._layers[d]=c,this._map.addLayer(a),this.domElement.appendChild(c.domElement),this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex)),this.options.zoomToExtentOnAdd){var e=a.getBounds();for(var f in this._layers)e.extend(this._layers[f].layer.getBounds());this._map.fitBounds(e)}},removeLayer:function(a){var b=L.stamp(a);return this.domElement.removeChild(this._layers[b].domElement),this._map.removeLayer(a),this.selection.remove(a),delete this._layers[b],this},_buildListItemDomElement:function(a){function b(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&++b;return b}var c=this,d=document.createElement("input");d.setAttribute("type","checkbox"),d.setAttribute("checked","true"),d.className="layer-toggle",d.setAttribute("data-id",L.stamp(a.layer)),d.onchange=this._handleLayerChange.bind(this,a);var e=document.createElement("div");e.className="layer-name",e.innerHTML=a.name,e.setAttribute("data-id",L.stamp(a.layer)),e.setAttribute("data-layer",b(c._layers)),e.onclick=this._handleLayerClick.bind(this,a);var f=document.createElement("li");return f.className="layer-element "+a.name,f.appendChild(d),f.appendChild(e),f},_handleLayerChange:function(a,b){var c=b.target;c.checked?this._map.addLayer(a.layer):this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer)},_handleLayerClick:function(a,b){var c=document.getElementsByClassName("layer-name");if(elem=b.currentTarget,-1==elem.className.indexOf("selected")){if(b.metaKey);else{if(b.shiftKey){for(var d=elem.getAttribute("data-layer"),e=[d],f=document.getElementsByClassName("selected"),g=0;g<f.length;g++)e.push(f[g].getAttribute("data-layer"));for(var h=Math.max.apply(null,e),i=Math.min.apply(null,e),j=i-1;h>j;j++)-1==c[j].className.indexOf("selected")&&(c[j].className+=" selected",this.selection.add({info:this._layers[c[j].getAttribute("data-id")],layer:this._layers[c[j].getAttribute("data-id")].layer}));return}this.selection.clear()}elem.className+=" selected",this.selection.add({info:a,layer:a.layer})}else b.metaKey?(this.selection.remove(a.layer),elem.className=elem.className.replace(/\b selected\b/,"")):(this.selection.clear(),this.selection.add({info:a,layer:a.layer}),elem.className+=" selected")}}),L.DNC=L.DNC||{},L.DNC.MapView=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.numLayers=0,this._map=null,this._setupMap()},_setupMap:function(){L.mapbox.accessToken="pk.eyJ1Ijoic3ZtYXR0aGV3cyIsImEiOiJVMUlUR0xrIn0.NweS_AttjswtN5wRuWCSNA",this._map=L.mapbox.map("map",null,{zoomControl:!1}).setView([0,0],3);var a={"Mapbox Streets":L.mapbox.tileLayer("mapbox.streets"),"Mapbox Outdoors":L.mapbox.tileLayer("mapbox.outdoors"),"Mapbox Light":L.mapbox.tileLayer("mapbox.light"),"Mapbox Dark":L.mapbox.tileLayer("mapbox.dark"),"Mapbox Satellite":L.mapbox.tileLayer("mapbox.satellite")};a["Mapbox Streets"].addTo(this._map),L.control.layers(a,{},{position:"bottomright",collapsed:!1}).addTo(this._map),L.control.zoom({position:"topright"}).addTo(this._map)}}),L.DNC=L.DNC||{},L.DNC.Menu=L.Class.extend({includes:L.Mixin.Events,options:{items:[],menuDirection:"below"},initialize:function(a,b){L.setOptions(this,b),this.title=a,this.children=this._buildMenuItems(this.options.items),this.domElement=this._buildDomElement(this.children),this._addEventHandlers()},_addEventHandlers:function(){function a(){var a=this.querySelector(".menu-dropdown");if(-1==a.className.indexOf("expanded")){for(var b=document.getElementsByClassName("expanded"),c=0;c<b.length;c++)b[c].className=b[c].className.replace(/\b expanded\b/,"");a.className+=" expanded"}else a.className=a.className.replace(/\b expanded\b/,"")}function b(){c.fire("clickedOperation",{action:this.id||c.title.toLowerCase()})}var c=this;if(this.domElement&&this.children.length&&this.domElement.addEventListener("click",a,!1),this.children.length)for(var d=0;d<this.children.length;d++)this.children[d].addEventListener("click",b,!1);else this.domElement.addEventListener("click",b,!1)},addTo:function(a){var b=a.domElement||a;return b.appendChild(this.domElement),this.parent=a,this},_buildMenuItems:function(a){for(var b=[],c=0;c<a.length;c++){var d=document.createElement("button");d.className="menu-button menu-button-action",d.id=a[c],d.innerHTML=a[c],b.push(d)}return b},_buildDomElement:function(a){var b=document.createElement("div");b.className="menu";var c=document.createElement("button");c.className="menu-button",c.innerHTML=this.title;var d=document.createElement("i");this.options.iconClassName?d.className=this.options.iconClassName:a.length&&(d.className="above"==this.options.menuDirection?"fa fa-angle-up":"fa fa-angle-down");var e=document.createElement("div");e.className="menu-dropdown menu-expand","above"==this.options.menuDirection&&(e.className+=" opens-above");for(var f=0;f<a.length;f++)e.appendChild(a[f]);return c.appendChild(d),b.appendChild(c),b.appendChild(e),b}}),L.DNC=L.DNC||{},L.DNC.MenuBar=L.Class.extend({includes:L.Mixin.Events,options:{id:"#menu-bar",classList:[]},initialize:function(a){L.setOptions(this,a),this.children=[],this.domElement=this._buildDomElement(this.options.id,this.options.classList)},addTo:function(a){var b=a.domElement||a;return b.appendChild(this.domElement),this.parent=a,this},_buildDomElement:function(a,b){var c=document.createElement("nav");c.id=a;for(var d=0;d<b.length;d++)c.classList.add(b[d]);return c}}),L.DNC=L.DNC||{},L.DNC.Notifications=L.Class.extend({statics:{},options:{},initialize:function(a,b){L.setOptions(this,b),this.domElement=this._buildDomElement(),this.hub=document.getElementById("notifications")},add:function(a){params={},params.text=a.text||"THIS NOTIFICATION REQUIRES TEXT",params.time=a.time||4e3,params.type=a.type||"default";var b=document.createElement("div");b.className="notification "+a.type,b.innerHTML=a.text,this.hub.appendChild(b);var c=this;setTimeout(function(){c.hub.removeChild(c.hub.firstChild)},params.time)},_buildDomElement:function(){var a=document.createElement("div");return a.id="notifications",document.body.appendChild(a),a}}),L.DNC=L.DNC||{},L.DNC.BaseExecute=L.Class.extend({includes:L.Mixin.Events,options:{},execute:function(){throw new Error("Execute method not implemented")},validate:function(a,b,c){function d(a){this.name="ValidationError",this.message=a||"Validation Error"}var e=b.length;if(d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,c.maxFeatures&&e>c.maxFeatures)throw new d("Too many layers. Max is set to "+c.maxFeatures+", got "+e+".");if(c.minFeatures&&e<c.minFeatures)throw new d("Too few layers. Min is set to "+c.minFeatures+", got "+e+".")}}),L.DNC.File=L.Class.extend({includes:L.Mixin.Events,options:{},remove:{minFeatures:1,description:"Removes a layer from the application.",disableForm:!0},upload:{parameters:[{description:"File to upload.",type:"file",extra:"multiple"}]},"load from url":{description:"Import file from a URL",parameters:[{name:"url",description:"URL",type:"text","default":"http://"}]}}),L.DNC=L.DNC||{},L.DNC.FileExecute=L.DNC.BaseExecute.extend({includes:L.Mixin.Events,options:{},execute:function(a,b,c,d,e){var f=this,g={remove:function(a,b,c,d){e({remove:d.map(function(a){return{layer:a.layer,name:a.info.name}})})},upload:function(){var a=document.querySelectorAll("input[type=file]")[0].files;f.fire("uploadedfiles",a)},"load from url":function(a,b){var c=b[0],d=new XMLHttpRequest;d.open("GET",encodeURI(c)),d.onload=function(){if(200===d.status){var a=JSON.parse(d.responseText),b=d.responseURL.substring(d.responseURL.lastIndexOf("/")+1);"FeatureCollection"==a.geometry.type&&1==a.geometry.features.length&&(a.geometry=this._unCollect(a.geometry)),e({add:[{geometry:a,name:b}]})}else console.error("Request failed. Returned status of "+d.status)},d.send()}};if("function"!=typeof g[a])throw new Error("Invalid action.");return g[a](a,b,c,d)}}),L.DNC.Geo=L.Class.extend({includes:L.Mixin.Events,options:{},bezier:{minFeatures:1,description:"Takes a line and returns a curved version by applying a Bezier spline algorithm.",parameters:[{name:"resolution",description:"Time in milliseconds between points",type:"number","default":1e4},{name:"sharpness",description:"a measure of how curvy the path should be between splines",type:"number","default":.85}]},buffer:{maxFeatures:1,description:"Calculates a buffer for input features for a given radius. Units supported are miles, kilometers, and degrees.",parameters:[{name:"distance",description:"Distance to draw the buffer.",type:"number","default":10},{name:"unit",type:"select",description:"",options:["miles","feet","kilometers","meters","degrees"],"default":"miles"}]},center:{minFeatures:1,maxFeatures:1,description:"Creates a point in the center of the feature."},centroid:{minFeatures:1,maxFeatures:1,description:"Creates a point in the centroid of the features."},envelope:{minFeatures:1,maxFeatures:1,description:"Extent of all the features."},union:{minFeatures:2,maxFeatures:2,description:"Takes two polygons and returns a combined polygon. If the input polygons are not contiguous, this function returns a MultiPolygon feature."},tin:{minFeatures:1,maxFeatures:1,description:"Triangulated irregular network, interpolation method"}}),L.DNC=L.DNC||{},L.DNC.GeoExecute=L.DNC.BaseExecute.extend({includes:L.Mixin.Events,options:{},execute:function(a,b,c,d,e){L.setOptions(this,c),this.action=a;var f=this._prepareParameters(d,c,b),g=this._prepareName(d),h={geometry:turf[this.action].apply(null,f),name:this.action+"_"+g+".geojson"};"FeatureCollection"==h.geometry.type&&1==h.geometry.features.length&&(h.geometry=this._unCollect(h.geometry)),e({add:[h]})},_prepareParameters:function(a,b,c){b.maxFeatures&&(a=a.slice(0,b.maxFeatures));var d=a.map(function(a){return a.layer._geojson});if(c)for(var e=0;e<c.length;e++)d.push(c[e]);return d},_prepareName:function(a){var b=a.map(function(a){return a.info.name}),c="";return c=1===b.length?b[0].split(".")[0]:b.reduce(function(a,b){return a.split(".")[0]+"_"+b.split(".")[0]})},_unCollect:function(a){return a.features[0]}});
//# sourceMappingURL=L.DNC.min.js.map