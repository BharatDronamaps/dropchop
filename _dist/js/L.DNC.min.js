!function(){var a={version:"0.0.1-dev"};"object"==typeof module&&"object"==typeof module.exports&&(module.exports=a),"undefined"!=typeof window&&window.L&&(window.L.DNC=a)}(),L.DNC=L.DNC||{},L.DNC.MenuBar=L.Class.extend({includes:L.Mixin.Events,initialize:function(a){L.setOptions(this,a),this.children=[],this.domElement=this._buildDomElement()},addChild:function(a,b){return b=b||this.domElement,b.appendChild(a.domElement),a.parent=this,this.children.push(a),this},addTo:function(a){var b=a.domElement||a;return b.appendChild(this.domElement),this.parent=a,this},_buildDomElement:function(){return document.createElement("div")}}),L.DNC=L.DNC||{},L.DNC.AppController=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.mapView=new L.DNC.MapView,this.dropzone=new L.DNC.DropZone(this.mapView._map,{}),this.layerlist=new L.DNC.LayerList({layerContainerId:"dropzone"}).addTo(this.mapView._map),this.menuBar=(new L.DNC.MenuBar).addTo(document.getElementById("menu-bar")).addChild(new L.DNC.Menu("Geoprocessing Tools",{}).addChild(new L.DNC.TurfOperation("buffer",{maxFeatures:1,additionalArgs:.1,icon:"icon-turf-buffer.svg"})).addChild(new L.DNC.TurfOperation("union",{minFeatures:2,maxFeatures:2,icon:"icon-turf-union.svg"})).addChild(new L.DNC.TurfOperation("erase",{minFeatures:2,maxFeatures:2,icon:"icon-turf-erase.svg"}))),this.notification=new L.DNC.Notifications,this._addEventHandlers()},_addEventHandlers:function(){this.dropzone.fileReader.on("fileparsed",this._handleParsedFile.bind(this)),this.menuBar.on("operation-result",this._handleTurfResults.bind(this))},_handleParsedFile:function(a){var b=L.mapbox.featureLayer(a.file);this.layerlist.addLayerToList(b,a.fileInfo.name,!0),this.mapView.numLayers++,this.notification.add({text:"<strong>"+a.fileInfo.name+"</strong> added successfully.",type:"success",time:2500})},_handleTurfResults:function(a){this.layerlist.addLayerToList(a.mapLayer,a.layerName,a.isOverlay)},getLayerSelection:function(){return this.layerlist.selection.list||[]}}),L.DNC=L.DNC||{},L.DNC.DropZone=L.Class.extend({statics:{TYPE:"dropzone"},options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this.type=L.DNC.DropZone.TYPE,this.fileReader=new L.DNC.DropZone.FileReader(this._map,b),this.fileReader.enable()}}),L.DNC.DropZone=L.DNC.DropZone||{},L.DNC.DropZone.FileReader=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this._container=document.body},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{options:this.options}),this._map.fire("dropzone:enabled",{options:this.options}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("dropzone:disabled",{options:this.options}),this.fire("disabled",{options:this.options}))},addHooks:function(){this._map&&(L.DomEvent.on(this._container,"dragover",this._handleDragOver,this),L.DomEvent.on(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.on(this._container,"drop",this._handleDrop,this))},removeHooks:function(){this._map&&(L.DomEvent.off(this._container,"dragover",this._handleDragOver,this),L.DomEvent.off(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.off(this._container,"drop",this._handleDrop,this))},_handleDragOver:function(a){a=a||event,a.preventDefault(),document.body.className="dragging"},_handleDragLeave:function(a){a=a||event,a.preventDefault(),document.body.className=""},_handleDrop:function(a){a=a||event,a.preventDefault(),document.body.className="";var b=a.dataTransfer.files;this._handleFiles(b)},_handleFiles:function(a){for(var b=0;b<a.length;b++)this._readFile(a[b])},_readFile:function(a){var b=new FileReader;b.readAsText(a,"UTF-8"),b.onload=function(){var c=JSON.parse(b.result);this._map.fire("dropzone:fileparsed",{file:c}),this.fire("fileparsed",{fileInfo:a,file:c})}.bind(this)}}),L.DNC=L.DNC||{},L.DNC.LayerList=L.Control.extend({options:{autoZIndex:!0,zoomToExtentOnAdd:!0,layerContainerId:"dropzone"},initialize:function(a){L.setOptions(this,a),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this.layerContainer=L.DomUtil.get(this.options.layerContainerId),this.selection={add:function(a){this.list.push(a)},remove:function(a){for(var b=0;b<this.list.length;b++)a._leaflet_id==this.list[b].layer._leaflet_id&&this.list.splice(b,1)},list:[]}},_initLayout:function(){this._container=L.DomUtil.create("ul","json-layer-list"),this._container.setAttribute("id","layer-list"),this.layerContainer.appendChild(this._container)},onAdd:function(a){return this._initLayout(),this._update(),this._container},addTo:function(a){return this.remove(),this._map=a,this._container=this.onAdd(a),this},remove:function(){return this._map?(this._container.parentElement.removeChild(this._container),this._container=null,this.onRemove&&this.onRemove(this._map),this._map=null,this):this},addLayerToList:function(a,b,c){var d=L.stamp(a);if(this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex)),this._update(),this.options.zoomToExtentOnAdd){var e=a.getBounds();for(var f in this._layers)e.extend(this._layers[f].layer.getBounds());this._map.fitBounds(e)}},removeLayerFromList:function(a){var b=L.stamp(a);return delete this._layers[b],this},_update:function(){if(!this._container)return this;for(var a in this._layers)obj=this._layers[a],this._map.hasLayer(obj.layer)||(this._map.addLayer(obj.layer),this._addItem(obj));return this},_addItem:function(a){var b=document.createElement("input");b.setAttribute("type","checkbox"),b.setAttribute("checked","true"),b.className="layer-toggle",b.setAttribute("data-id",L.stamp(a.layer)),b.onchange=this._handleLayerChange.bind(this,a);var c=document.createElement("div");c.className="layer-name",c.innerHTML=a.name,c.setAttribute("data-id",L.stamp(a.layer)),c.onclick=this._handleLayerClick.bind(this,a);var d=document.createElement("li");d.className="layer-element "+a.name,d.appendChild(b),d.appendChild(c),this._container.appendChild(d)},_handleLayerChange:function(a,b){var c=b.target;c.checked?this._map.addLayer(a.layer):this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer)},_handleLayerClick:function(a,b){-1==b.currentTarget.className.indexOf("selected")?(b.currentTarget.className+=" selected",this.selection.add({info:a,layer:a.layer})):(this.selection.remove(a.layer),b.currentTarget.className="layer-name")}}),L.DNC=L.DNC||{},L.DNC.MapView=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.numLayers=0,this._map=null,this._setupMap()},_setupMap:function(){L.mapbox.accessToken="pk.eyJ1Ijoic3ZtYXR0aGV3cyIsImEiOiJVMUlUR0xrIn0.NweS_AttjswtN5wRuWCSNA",this._map=L.mapbox.map("map","examples.map-zr0njcqy",{zoomControl:!1}).setView([0,0],3)}}),L.DNC=L.DNC||{},L.DNC.Menu=L.DNC.MenuBar.extend({initialize:function(a,b){L.setOptions(this,b),this.title=a,this.children=[],this.domElement=this._buildDomElement(),this._addEventHandlers()},addChild:function(a,b){return b=b||this.domElement.getElementsByClassName("menu-dropdown")[0],this.constructor.__super__.addChild.call(this,a,b)},_addEventHandlers:function(){function a(){var a=this.querySelector(".menu-dropdown");if(-1==a.className.indexOf("expanded")){for(var b=document.getElementsByClassName("expanded"),c=0;c<b.length;c++)b[c].className=b[c].className.replace(/\b expanded\b/,"");a.className+=" expanded"}else a.className=a.className.replace(/\b expanded\b/,"")}this.domElement&&this.domElement.addEventListener("click",a,!1)},_buildDomElement:function(){var a=document.createElement("div");return a.className="menu",a.innerHTML='<button class="menu-button">'+this.title+'<i class="fa fa-angle-down"></i></button><div class="menu-dropdown menu-expand"></div>',a}}),L.DNC=L.DNC||{},L.DNC.Operation=L.DNC.Menu.extend({_addEventHandlers:function(){this.domElement.addEventListener("click",function(){this.execute.call(this)}.bind(this))},_buildDomElement:function(){var a=document.createElement("div");return a.innerHTML+='<button class="menu-button menu-button-action" id="'+this.title+'">'+this.title+'<img class="icon" src="icons/'+this.options.icon+'"></button>',a.children[0]},execute:function(){console.error("L.DNC.Operation object did not properly override 'execute'",this)}}),L.DNC.TurfOperation=L.DNC.Operation.extend({options:{minFeatures:1,maxFeatures:0,orderImport:!1,icon:"no icon specified",additionalArgs:null},execute:function(){var a=L.DNC.app.getLayerSelection();this._validate(a);var b=this._prepareArgs(a),c=b[0],d=b[1],e={geometry:turf[this.title].apply(null,c),name:this.title+"_"+d+".geojson"};"FeatureCollection"==e.geometry.type&&1==e.geometry.features.length&&(e.geometry=this._unCollect(e.geometry));var f=L.mapbox.featureLayer(e.geometry),g={mapLayer:f,layerName:e.name,isOverlay:!0};this.parent.parent.fire("operation-result",g)},_validate:function(a){var b=a.length;if(!b)throw new Error("Can't run "+this.title+" on empty selection.");if(this.options.maxFeatures&&b>this.options.maxFeatures)throw new Error("Too many layers. Max is set to "+this.options.maxFeatures+", got "+b+".");if(this.options.minFeatures&&b<this.options.minFeatures)throw new Error("Too few layers. Min is set to "+this.options.minFeatures+", got "+b+".")},_prepareArgs:function(a){this.options.maxFeatures&&(a=a.slice(0,this.options.maxFeatures));var b=a.map(function(a){return a.layer._geojson});this.options.additionalArgs&&b.push(this.options.additionalArgs);var c=a.map(function(a){return a.info.name}),d="";return d=1===c.length?c[0].split(".")[0]:c.reduce(function(a,b){return a.split(".")[0]+"_"+b.split(".")[0]}),[b,d]},_unCollect:function(a){return a.features[0]}}),L.DNC=L.DNC||{},L.DNC.Notifications=L.Class.extend({statics:{},options:{},initialize:function(a,b){L.setOptions(this,b),this.hub=document.getElementById("notifications")},add:function(a){params={},params.text=a.text||"THIS NOTIFICATION REQUIRES TEXT",params.time=a.time||4e3,params.type=a.type||"default";var b=document.createElement("div");b.className="notification "+a.type,b.innerHTML=a.text,this.hub.appendChild(b);var c=this;setTimeout(function(){c.hub.removeChild(c.hub.firstChild)},params.time)}});
//# sourceMappingURL=L.DNC.min.js.map